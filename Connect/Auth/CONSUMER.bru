meta {
  name: CONSUMER
  type: http
  seq: 4
}

post {
  url: {{AZURE_TENANT_URL}}/{{AZURE_TENANT_ID}}/oauth2/v2.0/token
  body: formUrlEncoded
  auth: none
}

headers {
  content-type: application/x-www-form-urlencoded
}

body:form-urlencoded {
  grant_type: client_credentials
  scope: {{CONSUMER_SCOPE}}/.default
  client_id: {{CONSUMER_CLIENT_ID}}
  client_secret: {{CONSUMER_CLIENT_SECRET}}
}

script:post-response {
  bru.setVar('CONSUMER_BEARER',res.body.access_token);
}
